/*******************************************************************************
	gamma.c -- ガンマ関数
	        -- ベータ関数
	※奥村教授の事典の追補。第三版を出すらしく
*******************************************************************************/
#include <math.h>

/*******************************************************************************
Test Result:
Prof. Okumura's source:
----
  x    LogGamma(x)
-5.5  -4.51783217400774
-4.5   nan
-3.5  -1.30900668499304
-2.5   nan
-1.5   0.86004701537648
-0.5   nan
 0.5   0.5723649429247
 1.0   0
 2.0   0
 3.0   0.693147180559944
 4.0   1.79175946922805
 5.0   3.17805383034795
10.0   12.8018274800815
15.0   25.1912211827387
20.0   39.3398841871995
25.0   54.7847293981123
30.0   71.257038967168
----

modified (by p-adic logarithmic function):
  x    LogGamma(x)
-5.5  -4.51783217400774
-4.5  -2.81308408176932
-3.5  -1.30900668499304
-2.5  -0.0562437164976757
-1.5   0.86004701537648
-0.5   1.26551212348464
 0.5   0.5723649429247
 1.0   0
 2.0   0
 3.0   0.693147180559944
 4.0   1.79175946922805
 5.0   3.17805383034795
10.0   12.8018274800815
15.0   25.1912211827387
20.0   39.3398841871995
25.0   54.7847293981123
30.0   71.257038967168
*******************************************************************************/

#define PI      3.14159265358979324  /* $\pi$ */
#define LOG_2PI 1.83787706640934548  /* $\log 2\pi$ */
#define N       8

#define B0  1                 /* 以下はBernoulli数 */
#define B1  (-1.0 / 2.0)
#define B2  ( 1.0 / 6.0)
#define B4  (-1.0 / 30.0)
#define B6  ( 1.0 / 42.0)
#define B8  (-1.0 / 30.0)
#define B10 ( 5.0 / 66.0)
#define B12 (-691.0 / 2730.0)
#define B14 ( 7.0 / 6.0)
#define B16 (-3617.0 / 510.0)

/* ガンマ関数の対数 */
double
loggamma(double x)
{
	double v, w;

	v = 1;
	while (x < N) {  v *= x;  x++;  }
	w = 1 / (x * x);
	return ((((((((B16 / (16 * 15))  * w + (B14 / (14 * 13))) * w
	            + (B12 / (12 * 11))) * w + (B10 / (10 *  9))) * w
	            + (B8  / ( 8 *  7))) * w + (B6  / ( 6 *  5))) * w
	            + (B4  / ( 4 *  3))) * w + (B2  / ( 2 *  1))) / x
	            + 0.5 * LOG_2PI - log(fabs(v)) - x + (x - 0.5) * log(fabs(x));
}

#include <stdio.h>
#include <stdlib.h>
#include <float.h>

int
main(void)
{
	double x;

	printf("  x    LogGamma(x)\n");
	for (x = -5.5; x <= 0.51; x += 1.0)
		printf("%4.1f  % .*g\n", x, DBL_DIG, loggamma(x));
	for (x = 1; x <= 5.1; x += 1.0)
		printf("%4.1f  % .*g\n", x, DBL_DIG, loggamma(x));
	for (x = 10; x <= 30.1; x += 5.0)
		printf("%4.1f  % .*g\n", x, DBL_DIG, loggamma(x));

	puts("");

	puts("Negative-integer's ComplexInfinity Check");
	for (volatile int i = -5; i <= 0; i++)
	{
		x = i;
		printf("%4.1f  % .*g\n", x, DBL_DIG, loggamma(x));
	}

	return 0;
}
